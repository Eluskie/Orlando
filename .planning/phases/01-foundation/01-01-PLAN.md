---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - drizzle.config.ts
  - .env.local
  - .env.example
  - src/lib/db/schema.ts
  - src/lib/db/index.ts
  - src/types/brand.ts
  - src/types/generation.ts
  - src/types/chat.ts
  - src/app/layout.tsx
  - src/app/page.tsx
autonomous: true

must_haves:
  truths:
    - "Next.js dev server starts without errors"
    - "Database connection succeeds to Neon PostgreSQL"
    - "Schema migrations run successfully"
    - "TypeScript compiles without errors"
  artifacts:
    - path: "src/lib/db/schema.ts"
      provides: "Drizzle schema for brands, conversations, generations, assets"
      contains: ["brands", "conversations", "generations", "assets"]
    - path: "src/lib/db/index.ts"
      provides: "Database client connection"
      exports: ["db"]
    - path: "drizzle.config.ts"
      provides: "Drizzle Kit configuration"
      contains: "schema"
    - path: "src/types/brand.ts"
      provides: "BrandStyle TypeScript interface"
      exports: ["BrandStyle"]
  key_links:
    - from: "src/lib/db/index.ts"
      to: "@neondatabase/serverless"
      via: "neon() connection"
      pattern: "neon\\("
    - from: "src/lib/db/schema.ts"
      to: "src/types/brand.ts"
      via: "jsonb type reference"
      pattern: "\\$type<BrandStyle>"
---

<objective>
Initialize Next.js 15.5 project with database schema and type definitions.

Purpose: Establish the foundational infrastructure that all subsequent phases depend on. A working database schema is prerequisite for chat, canvas, and generation features.

Output: Running Next.js development server with connected Neon PostgreSQL database and complete schema for brands, conversations, generations, and assets.
</objective>

<execution_context>
@C:\Users\gerar\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\gerar\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/research/STACK.md
@.planning/research/ARCHITECTURE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Next.js project with dependencies</name>
  <files>
    - package.json
    - tsconfig.json
    - .env.local
    - .env.example
  </files>
  <action>
Create Next.js 15.5 project using `npx create-next-app@latest . --typescript --tailwind --eslint --app --src-dir --no-git --use-npm`.

After project creation, install required dependencies:
```bash
npm install drizzle-orm @neondatabase/serverless zustand konva react-konva ai @ai-sdk/google lucide-react
npm install -D drizzle-kit @types/node
```

Create `.env.local` with placeholder:
```
DATABASE_URL=postgresql://user:password@host/database?sslmode=require
```

Create `.env.example` (same structure, no values):
```
DATABASE_URL=
```

Note: User must provide actual Neon connection string. This is standard Next.js + database setup - Claude can scaffold but user provides credentials.
  </action>
  <verify>
Run `npm run dev` - dev server starts on localhost:3000 without errors.
Run `npm ls drizzle-orm` - confirms drizzle-orm installed.
  </verify>
  <done>
Next.js 15.5 project runs locally with all Phase 1-5 dependencies installed. Environment file template exists.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create database schema with Drizzle ORM</name>
  <files>
    - drizzle.config.ts
    - src/lib/db/schema.ts
    - src/lib/db/index.ts
    - src/types/brand.ts
    - src/types/generation.ts
    - src/types/chat.ts
  </files>
  <action>
Create `drizzle.config.ts` at project root:
```typescript
import { defineConfig } from 'drizzle-kit';

export default defineConfig({
  schema: './src/lib/db/schema.ts',
  out: './drizzle',
  dialect: 'postgresql',
  dbCredentials: {
    url: process.env.DATABASE_URL!,
  },
});
```

Create `src/types/brand.ts`:
```typescript
export interface BrandStyle {
  primaryColor?: string;
  secondaryColor?: string;
  accentColor?: string;
  fontFamily?: string;
  headingFont?: string;
  tone?: string; // e.g., "playful", "corporate", "minimalist"
  keywords?: string[];
  referenceImages?: string[]; // URLs to uploaded references
}
```

Create `src/types/generation.ts`:
```typescript
export type GenerationStatus = 'pending' | 'processing' | 'completed' | 'failed';
export type AssetType = 'logo' | 'banner' | 'social' | 'illustration' | 'custom';

export interface GenerationMetadata {
  model?: string;
  seed?: number;
  negativePrompt?: string;
  aspectRatio?: string;
  styleStrength?: number;
}
```

Create `src/types/chat.ts`:
```typescript
export interface ChatMessage {
  id: string;
  role: 'user' | 'assistant' | 'system';
  content: string;
  toolCalls?: ToolCall[];
  createdAt: string;
}

export interface ToolCall {
  id: string;
  name: string;
  arguments: Record<string, unknown>;
  result?: unknown;
}
```

Create `src/lib/db/schema.ts` with complete schema:
```typescript
import { pgTable, text, timestamp, jsonb, uuid } from 'drizzle-orm/pg-core';
import type { BrandStyle } from '@/types/brand';
import type { GenerationStatus, AssetType, GenerationMetadata } from '@/types/generation';
import type { ChatMessage } from '@/types/chat';

export const brands = pgTable('brands', {
  id: uuid('id').defaultRandom().primaryKey(),
  name: text('name').notNull(),
  description: text('description'),
  style: jsonb('style').$type<BrandStyle>().notNull().default({}),
  createdAt: timestamp('created_at').defaultNow().notNull(),
  updatedAt: timestamp('updated_at').defaultNow().notNull(),
});

export const conversations = pgTable('conversations', {
  id: uuid('id').defaultRandom().primaryKey(),
  brandId: uuid('brand_id').references(() => brands.id, { onDelete: 'cascade' }),
  messages: jsonb('messages').$type<ChatMessage[]>().notNull().default([]),
  createdAt: timestamp('created_at').defaultNow().notNull(),
  updatedAt: timestamp('updated_at').defaultNow().notNull(),
});

export const generations = pgTable('generations', {
  id: uuid('id').defaultRandom().primaryKey(),
  brandId: uuid('brand_id').references(() => brands.id, { onDelete: 'cascade' }).notNull(),
  conversationId: uuid('conversation_id').references(() => conversations.id, { onDelete: 'set null' }),
  prompt: text('prompt').notNull(),
  enhancedPrompt: text('enhanced_prompt'),
  status: text('status').$type<GenerationStatus>().notNull().default('pending'),
  assetType: text('asset_type').$type<AssetType>().notNull(),
  assetUrl: text('asset_url'),
  thumbnailUrl: text('thumbnail_url'),
  metadata: jsonb('metadata').$type<GenerationMetadata>(),
  errorMessage: text('error_message'),
  createdAt: timestamp('created_at').defaultNow().notNull(),
  completedAt: timestamp('completed_at'),
});

export const assets = pgTable('assets', {
  id: uuid('id').defaultRandom().primaryKey(),
  brandId: uuid('brand_id').references(() => brands.id, { onDelete: 'cascade' }).notNull(),
  generationId: uuid('generation_id').references(() => generations.id, { onDelete: 'set null' }),
  name: text('name').notNull(),
  type: text('type').$type<'generated' | 'uploaded' | 'reference'>().notNull(),
  url: text('url').notNull(),
  thumbnailUrl: text('thumbnail_url'),
  canvasPosition: jsonb('canvas_position').$type<{ x: number; y: number; width: number; height: number }>(),
  createdAt: timestamp('created_at').defaultNow().notNull(),
});

// Export types for use in application
export type Brand = typeof brands.$inferSelect;
export type NewBrand = typeof brands.$inferInsert;
export type Conversation = typeof conversations.$inferSelect;
export type NewConversation = typeof conversations.$inferInsert;
export type Generation = typeof generations.$inferSelect;
export type NewGeneration = typeof generations.$inferInsert;
export type Asset = typeof assets.$inferSelect;
export type NewAsset = typeof assets.$inferInsert;
```

Create `src/lib/db/index.ts`:
```typescript
import { neon } from '@neondatabase/serverless';
import { drizzle } from 'drizzle-orm/neon-http';
import * as schema from './schema';

const sql = neon(process.env.DATABASE_URL!);
export const db = drizzle(sql, { schema });

export * from './schema';
```

Add script to package.json for migrations:
```json
"scripts": {
  "db:generate": "drizzle-kit generate",
  "db:push": "drizzle-kit push",
  "db:studio": "drizzle-kit studio"
}
```
  </action>
  <verify>
Run `npx tsc --noEmit` - no TypeScript errors.
Run `npm run db:generate` - generates migration files in /drizzle folder (requires valid DATABASE_URL).
  </verify>
  <done>
Database schema defined with brands, conversations, generations, and assets tables. TypeScript types exported. Drizzle configuration ready for migrations.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update app layout and homepage placeholder</name>
  <files>
    - src/app/layout.tsx
    - src/app/page.tsx
  </files>
  <action>
Update `src/app/layout.tsx` to set up proper metadata and font configuration:
```typescript
import type { Metadata } from 'next';
import { Inter } from 'next/font/google';
import './globals.css';

const inter = Inter({ subsets: ['latin'], variable: '--font-inter' });

export const metadata: Metadata = {
  title: 'Dobra - Brand Style Consistency',
  description: 'AI-powered brand style extraction and asset generation',
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body className={`${inter.variable} font-sans antialiased`}>
        {children}
      </body>
    </html>
  );
}
```

Update `src/app/page.tsx` with a minimal placeholder that confirms the app is running:
```typescript
export default function Home() {
  return (
    <main className="flex min-h-screen flex-col items-center justify-center p-24">
      <div className="text-center">
        <h1 className="text-4xl font-bold tracking-tight text-gray-900 mb-4">
          Dobra
        </h1>
        <p className="text-lg text-gray-600">
          Brand style consistency platform
        </p>
        <p className="text-sm text-gray-400 mt-8">
          Phase 1: Foundation - Setup complete
        </p>
      </div>
    </main>
  );
}
```
  </action>
  <verify>
Run `npm run dev` and visit http://localhost:3000 - shows "Dobra" heading with "Phase 1: Foundation - Setup complete" message.
  </verify>
  <done>
App layout configured with Inter font and proper metadata. Homepage displays confirmation that foundation is ready.
  </done>
</task>

</tasks>

<verification>
1. `npm run dev` starts without errors
2. `npx tsc --noEmit` compiles without TypeScript errors
3. http://localhost:3000 shows the Dobra placeholder page
4. `src/lib/db/schema.ts` exports brands, conversations, generations, assets tables
5. All type files exist: brand.ts, generation.ts, chat.ts
6. `npm run db:generate` works (with valid DATABASE_URL)
</verification>

<success_criteria>
- Next.js 15.5 project initialized with App Router and TypeScript
- All dependencies installed (drizzle-orm, @neondatabase/serverless, zustand, konva, react-konva, ai, lucide-react)
- Database schema defines brands, conversations, generations, assets tables
- TypeScript types defined for BrandStyle, GenerationMetadata, ChatMessage
- Development server runs and displays placeholder
- Drizzle Kit configured for PostgreSQL migrations
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>

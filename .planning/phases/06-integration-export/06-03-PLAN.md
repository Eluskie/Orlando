---
phase: 06-integration-export
plan: 03
type: execute
wave: 2
depends_on: ["06-01", "06-02"]
files_modified:
  - src/components/ui/loading-spinner.tsx
  - src/components/ui/toast.tsx
  - src/components/canvas/generation-toolbar.tsx
  - src/components/canvas/chat-sidebar.tsx
  - src/app/globals.css
autonomous: true

must_haves:
  truths:
    - "Loading states shown during all async operations"
    - "Toast notifications for success/error feedback"
    - "Smooth transitions between UI states"
    - "Error boundaries catch and display errors gracefully"
    - "Consistent Linear/Anthropic aesthetic throughout"
    - "Responsive feedback for user actions"
  artifacts:
    - path: "src/components/ui/loading-spinner.tsx"
      provides: "Reusable loading spinner component"
      exports: ["LoadingSpinner"]
    - path: "src/components/ui/toast.tsx"
      provides: "Toast notification system"
      exports: ["Toast", "useToast", "Toaster"]
---

<objective>
Add loading states, toast notifications, transitions, and final UX polish. Ensure consistent Linear/Anthropic aesthetic throughout the application.

Purpose: This completes UX-01 and UX-03 (modern clean aesthetic, responsive interactions). Users get clear feedback for all actions, smooth transitions, and a polished professional interface.

Output: Loading spinners, toast system, polished animations, consistent design language, graceful error handling.
</objective>

<execution_context>
@C:\Users\gerar\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\gerar\.claude/get-shit-done/templates/summary.md
@C:\Users\gerar\.claude/get-shit-done/references/ui-brand.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/app/globals.css
@src/components/canvas/generation-toolbar.tsx
@src/components/chat/chat-sidebar.tsx
@src/components/canvas/export-menu.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create UI primitives (spinner, toast)</name>
  <files>
    src/components/ui/loading-spinner.tsx
    src/components/ui/toast.tsx
  </files>
  <action>
1. Create `src/components/ui/loading-spinner.tsx`:
   - Simple reusable spinner component
   - Props: size ('sm' | 'md' | 'lg'), className (optional)
   - Use Tailwind animate-spin
   - Render: `<div className={cn("animate-spin rounded-full border-2 border-gray-300 border-t-indigo-600", sizeClasses, className)} />`
   - Size variants: sm (w-4 h-4), md (w-8 h-8), lg (w-12 h-12)
   - Export LoadingSpinner

2. Create `src/components/ui/toast.tsx`:
   - Install sonner if not present: `npm install sonner`
   - Re-export toast utilities: `export { toast } from 'sonner'`
   - Export `<Toaster />` component (from sonner) with custom styling
   - Configure position: bottom-right
   - Theme: light (matches Linear aesthetic)
   - Custom CSS classes for indigo accent colors
   - Success: green, Error: red, Info: indigo
   - Export useToast hook if needed for programmatic control

3. Add Toaster to root layout:
   - Update `src/app/layout.tsx` (or create if missing)
   - Import Toaster from @/components/ui/toast
   - Add `<Toaster />` at root level (outside main content, sibling to body children)
  </action>
  <verify>
    - LoadingSpinner renders with different sizes
    - Toast system functional (can call toast.success(), toast.error())
    - Toaster appears in correct position
  </verify>
  <done>
    - LoadingSpinner component created
    - Toast notification system integrated
    - Toaster added to root layout
    - Consistent styling with indigo accent
  </done>
</task>

<task type="auto">
  <name>Task 2: Add loading states to async operations</name>
  <files>
    src/components/canvas/generation-toolbar.tsx
    src/components/chat/chat-sidebar.tsx
    src/components/canvas/export-menu.tsx
  </files>
  <action>
1. Update `generation-toolbar.tsx`:
   - Already has isGenerating state (from Plan 05-02)
   - Add toast notifications:
     - On generation start: toast.info('Generating images...')
     - On success: toast.success('Images added to canvas')
     - On error: toast.error('Generation failed. Please try again.')
   - Replace loading text with LoadingSpinner component during generation
   - Disable all inputs during generation (already disabled, verify)

2. Update `chat-sidebar.tsx` (from Plan 06-01):
   - Add toast for generation from chat:
     - On generation start: toast.info('Generating from chat...')
     - On success: toast.success('Images added to canvas')
     - On error: toast.error('Failed to generate')
   - Show LoadingSpinner in chat input area when isGenerating
   - Disable input during generation

3. Update `export-menu.tsx` (from Plan 06-02):
   - Add toast notifications:
     - On export start: toast.info('Exporting canvas...')
     - On success: toast.success('Export complete')
     - On error: toast.error('Export failed')
   - Show LoadingSpinner in menu when isExporting
   - Disable menu options during export

4. Import LoadingSpinner and toast in all three files
  </action>
  <verify>
    - Loading spinners appear during async operations
    - Toast notifications show for all actions
    - Inputs disabled during loading
    - Error messages clear and helpful
  </verify>
  <done>
    - Loading states added to generation
    - Loading states added to chat generation
    - Loading states added to export
    - Toast notifications for all operations
    - Consistent feedback patterns
  </done>
</task>

<task type="auto">
  <name>Task 3: UX polish and transitions</name>
  <files>
    src/app/globals.css
    src/components/canvas/generation-toolbar.tsx
    src/components/chat/chat-sidebar.tsx
  </files>
  <action>
1. Update `globals.css`:
   - Verify Inter font is loaded (should be from Phase 1)
   - Add smooth scroll behavior: `html { scroll-behavior: smooth; }`
   - Add global focus styles for accessibility:
     ```css
     *:focus-visible {
       @apply outline-2 outline-offset-2 outline-indigo-500;
     }
     ```
   - Add transition utilities for common animations:
     ```css
     .transition-slide {
       @apply transition-transform duration-300 ease-in-out;
     }
     ```
   - Ensure consistent spacing and colors match Linear aesthetic (indigo primary, clean whites/grays)

2. Add transitions to `generation-toolbar.tsx`:
   - Panel expand/collapse: Add `transition-all duration-300 ease-in-out` to panel container
   - Smooth opacity fade for collapsed/expanded states
   - Button hover states: `transition-colors duration-200`

3. Add transitions to `chat-sidebar.tsx`:
   - Slide animation for sidebar open/close
   - Use transform: translateX() with transition-transform
   - Collapsed button appears with fade-in
   - Message list smooth scroll

4. Review all components for:
   - Consistent indigo-600 primary color
   - Hover states on interactive elements
   - Focus states for accessibility
   - Proper spacing (Tailwind spacing scale)
   - Clean white/gray backgrounds (no pure black text)
   - Rounded corners consistent (rounded-lg for cards, rounded-md for inputs)

5. Test responsiveness:
   - Canvas works on different screen sizes
   - Chat sidebar adapts appropriately
   - Generation toolbar accessible on mobile (may need adjustment)
  </action>
  <verify>
    - Smooth transitions between states
    - Consistent color scheme throughout
    - Focus states visible for accessibility
    - Hover effects polished
    - No jarring state changes
  </verify>
  <done>
    - Smooth transitions added
    - Consistent Linear/Anthropic aesthetic
    - Accessibility focus states
    - Polished hover effects
    - Professional, clean interface
  </done>
</task>

<task type="auto">
  <name>Task 4: Error boundaries and graceful failures</name>
  <files>
    src/components/error-boundary.tsx
    src/app/error.tsx
  </files>
  <action>
1. Create `src/components/error-boundary.tsx`:
   - React Error Boundary component
   - Catches errors in component tree
   - Displays friendly error message
   - Option to reload or go back
   - Logs error to console
   - Simple clean UI matching app aesthetic

2. Create `src/app/error.tsx` (Next.js convention):
   - 'use client' directive
   - Error page for unhandled errors
   - Props: error, reset function
   - Display: "Something went wrong" message
   - Button to try again (calls reset())
   - Button to go home
   - Clean, centered layout

3. Wrap critical components:
   - Consider wrapping canvas workspace
   - Consider wrapping chat components
   - Or rely on Next.js error.tsx for app-level errors

4. Add try-catch to critical async operations:
   - Generation API calls
   - Export operations
   - Chat API calls
   - Show toast.error() with helpful message
   - Don't crash the app
  </action>
  <verify>
    - Error boundary catches component errors
    - Error page renders for app-level errors
    - User can recover from errors
    - Errors don't crash entire app
  </verify>
  <done>
    - Error boundary component created
    - Error page created
    - Graceful error handling throughout
    - User-friendly error messages
    - Recovery options available
  </done>
</task>

</tasks>

<verification>
1. Install sonner: `npm install sonner`
2. TypeScript compiles: `npx tsc --noEmit`
3. Dev server runs: `npm run dev`
4. Test loading states:
   - Generate images → see spinner and toast
   - Send chat message → see loading indicator
   - Export canvas → see export progress
5. Test transitions:
   - Toggle generation panel → smooth animation
   - Toggle chat sidebar → smooth slide
   - Hover buttons → smooth color transitions
6. Test error handling:
   - Trigger generation with invalid brandId → see error toast
   - Try export with no assets → graceful handling
7. Accessibility check:
   - Tab through interface → focus states visible
   - All interactive elements keyboard accessible
8. Visual consistency:
   - All buttons use indigo-600
   - Consistent spacing throughout
   - Clean, minimal aesthetic
</verification>

<success_criteria>
- Loading states shown during all async operations
- Toast notifications provide clear feedback
- Smooth transitions between UI states
- Error boundaries prevent app crashes
- Errors display user-friendly messages
- Consistent Linear/Anthropic aesthetic (clean, modern, indigo accent)
- Keyboard navigation works properly
- Focus states visible for accessibility
- No jarring UI changes
- Professional, polished feel throughout
</success_criteria>

<output>
After completion, create `.planning/phases/06-integration-export/06-03-SUMMARY.md`
</output>
